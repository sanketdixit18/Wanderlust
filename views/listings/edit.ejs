

<% layout('layouts/boilerplate') %>





<div class="row">
  <div class="col-12">
    <div class="form-container">
      <h1 class="mb-4 text-center text-primary">Edit Listing: <%= listing.title %></h1>
      
      <!-- IMPORTANT: Add enctype="multipart/form-data" for file handling -->
      <form action="/listings/<%= listing._id %>?_method=PUT" method="POST" novalidate class="needs-validation" enctype="multipart/form-data">
        
        <!-- Title -->
        <div class="mb-3 form-floating">
          <input type="text" name="title" id="title" class="form-control" placeholder="Title" value="<%= listing.title %>" required>
          <label for="title">Title</label>
        </div>

        <!-- Description -->
        <div class="mb-3 form-floating">
          <textarea name="description" id="description" class="form-control" placeholder="Description" required style="height: 100px"><%= listing.description %></textarea>
          <label for="description">Description</label>
        </div>
        
        <!-- Price, Location in a Row -->
        <div class="row">
          
          <!-- Price -->
          <div class="col-md-6 mb-3">
            <div class="form-floating">
              <!-- Ensure value is set to the current listing price -->
              <input type="number" name="price" id="price" class="form-control" placeholder="Price" value="<%= listing.price %>" required min="0">
              <label for="price">Price (₹)</label>
            </div>
          </div>
          
          <!-- Location -->
          <div class="col-md-6 mb-3">
            <div class="form-floating">
              <!-- Ensure value is set to the current listing location -->
              <input type="text" name="location" id="location" class="form-control" placeholder="Location" value="<%= listing.location %>" required>
              <label for="location">Location</label>
            </div>
          </div>
          
        </div>

        <!-- Country -->
        <div class="mb-4 form-floating">
          <!-- Ensure value is set to the current listing country -->
          <input type="text" name="country" id="country" class="form-control" placeholder="Country" value="<%= listing.country %>" required>
          <label for="country">Country</label>
        </div>


        <!-- Image Update Options Section -->
        <div class="mb-4 image-options-card">
            <h5 class="mb-3 text-secondary">Current Listing Image</h5>

            <% if (listing.image && listing.image.url) { %>
              <div class="mb-3">
                  <img src="<%= listing.image.url %>" class="img-fluid rounded shadow-sm" style="max-height: 150px; object-fit: cover;" alt="Current Image">
              </div>
            <% } %>

            <h5 class="mt-4 mb-3 text-primary">Update Image (Optional)</h5>
            <p class="small text-muted mb-3">
                Choose **EITHER** a new file upload **OR** paste a new image URL. Leave both blank to keep the current image.
            </p>

            <!-- Option 1: File Upload -->
            <div class="mb-4">
                <label for="imageUpload" class="form-label fw-bold">1. Upload New Image File:</label>
                <!-- Name should be 'image' to work with Multer -->
                <input type="file" name="image" id="imageUpload" class="form-control" accept="image/*">
            </div>

            <hr>

            <!-- Option 2: Image URL Paste -->
            <div class="mb-2">
                <label for="imageUrl" class="form-label fw-bold">2. Or Paste New Image URL:</label>
                <!-- Use name 'imageURL' -->
                <input type="text" name="imageURL" id="imageUrl" class="form-control" placeholder="e.g., https://example.com/new-listing.jpg">
            </div>
        </div>
        <!-- End Image Update Options Section -->

        <!-- Update Button -->
        <button type="submit" class="btn btn-success w-100 py-2">Update Listing</button>
      </form>

      <hr class="mt-4">
      
      <!-- Back Link -->
      <div class="text-center">
        <a href="/listings/<%= listing._id %>" class="btn btn-outline-secondary">⬅ Back to Listing</a>
      </div>

    </div>
  </div>
</div>